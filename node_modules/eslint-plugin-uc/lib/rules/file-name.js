const path = require('path');
const fs = require('fs')

module.exports = function (context) {
    return {
        'Program': function (node) {

            const filepath = path.resolve(context.getFilename());
            const dirpath = path.dirname(filepath);


            // file name to be snake case
            if (fs.existsSync(filepath)) {

                const dirname = dirpath.split('/').pop();
                const filename = path.basename(filepath, path.extname(filepath));
                const filenameWithExtension = path.basename(filepath);

                const snakeCaseRegex = new RegExp('^[a-z0-9_]+$');
                const snakeCaseTestFileRegex = new RegExp('^[a-z0-9_]+\.test\.[a-z]+$');

                if (!(snakeCaseRegex.test(filename) || snakeCaseTestFileRegex.test(filenameWithExtension))) {
                    context.report(node, "Filename '{{filename}}' is not in snake_case.", {filename});
                } else if (!snakeCaseRegex.test(dirname)){
                    context.report(node, "Dirname '{{dirname}}' is not in snake_case.", {dirname});
                }
            }
        }
    };
}